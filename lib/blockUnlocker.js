var _0x48b3=['PROP\x20Block\x20%d\x20payment\x20to\x20%s\x20for\x20%d%%\x20of\x20total\x20block\x20score:\x20%d','blockUnlocked','dateFormat','getReadableCoins',':workers:','balance','Error\x20with\x20unlocking\x20blocks\x20%j','Unlocked\x20%d\x20blocks\x20and\x20update\x20balances\x20for\x20%d\x20workers','interval','async','./apiInterfaces.js','daemon','wallet','api','./utils.js','poolServer','slushMining','./exceptionWriter.js','info','Started','waterfall','zrange',':blocks:candidates','WITHSCORES','error','Error\x20trying\x20to\x20get\x20pending\x20blocks\x20from\x20redis\x20%j','length','No\x20blocks\x20candidates\x20in\x20redis','split','push','filter','daemonType','default','forknote','bytecoin','fixBlockHeightRPC','height','blockUnlocker','useFirstVout','getblock','getblockheaderbyheight','Error\x20with\x20%s\x20RPC\x20request\x20for\x20block\x20%s\x20-\x20%j','serialized','unlocked','block_header','Error\x20with\x20getblockheaderbyheight\x20RPC\x20request\x20for\x20block\x20%s\x20-\x20%j','orphaned','depth','reward','parse','miner_tx','vout','amount','networkFee','No\x20pending\x20blocks\x20are\x20unlocked\x20yet\x20(%d\x20pending)','map','prop','hgetall','coin',':scores:prop:round','multi','exec','Error\x20with\x20getting\x20round\x20shares\x20from\x20redis\x20%j','workerScores','del',':scores:solo:round',':shares_actual:solo:round',':shares_actual:prop:round','zadd',':blocks:matured','rewardType','login','hash','time','difficulty','shares','join','forEach','hincrby',':scores:roundCurrent','sendToAll','blockOrphaned','yyyy-mm-dd\x20HH:MM:ss\x20Z','round','Error\x20with\x20cleaning\x20up\x20data\x20in\x20redis\x20for\x20orphan\x20block(s)\x20%j','zrem','poolFee','keys','Block\x20%d\x20donation\x20to\x20%s\x20as\x20%d\x20percent\x20of\x20reward:\x20%d','Unlocked\x20%d\x20block\x20with\x20reward\x20%d\x20and\x20donation\x20fee\x20%d.\x20Miners\x20reward:\x20%d','solo','SOLO\x20Block\x20%d\x20payment\x20to\x20%s\x20for\x20%d%%\x20of\x20total\x20block\x20score:\x20%d'];(function(_0x660f1a,_0x58d80f){var _0x1ae12c=function(_0xb74e38){while(--_0xb74e38){_0x660f1a['push'](_0x660f1a['shift']());}};_0x1ae12c(++_0x58d80f);}(_0x48b3,0x65));var _0x651d=function(_0xb67384,_0x27295a){_0xb67384=_0xb67384-0x0;var _0x156d7c=_0x48b3[_0xb67384];return _0x156d7c;};let async=require(_0x651d('0x0'));let apiInterfaces=require(_0x651d('0x1'))(config[_0x651d('0x2')],config[_0x651d('0x3')],config[_0x651d('0x4')]);let notifications=require('./notifications.js');let utils=require(_0x651d('0x5'));let slushMiningEnabled=config[_0x651d('0x6')][_0x651d('0x7')]&&config[_0x651d('0x6')]['slushMining']['enabled'];let logSystem='unlocker';require(_0x651d('0x8'))(logSystem);log(_0x651d('0x9'),logSystem,_0x651d('0xa'));function runInterval(){async[_0x651d('0xb')]([function(_0x1688bc){redisClient[_0x651d('0xc')](config['coin']+_0x651d('0xd'),0x0,-0x1,_0x651d('0xe'),function(_0x2d3fa5,_0x39b8f3){if(_0x2d3fa5){log(_0x651d('0xf'),logSystem,_0x651d('0x10'),[_0x2d3fa5]);_0x1688bc(!![]);return;}if(_0x39b8f3[_0x651d('0x11')]===0x0){log(_0x651d('0x9'),logSystem,_0x651d('0x12'));_0x1688bc(!![]);return;}let _0x5f5030=[];for(let _0x11b947=0x0;_0x11b947<_0x39b8f3['length'];_0x11b947+=0x2){let _0x4605c3=_0x39b8f3[_0x11b947][_0x651d('0x13')](':');_0x5f5030[_0x651d('0x14')]({'serialized':_0x39b8f3[_0x11b947],'height':parseInt(_0x39b8f3[_0x11b947+0x1]),'rewardType':_0x4605c3[0x0],'login':_0x4605c3[0x1],'hash':_0x4605c3[0x2],'time':_0x4605c3[0x3],'difficulty':_0x4605c3[0x4],'shares':_0x4605c3[0x5],'score':_0x4605c3[_0x651d('0x11')]>=0x7?_0x4605c3[0x6]:_0x4605c3[0x5]});}_0x1688bc(null,_0x5f5030);});},function(_0x7f54d4,_0xf4c8ac){async[_0x651d('0x15')](_0x7f54d4,function(_0x245a6b,_0x1fc6b2){let _0x1d60a2=config[_0x651d('0x16')]?config['daemonType']['toLowerCase']():_0x651d('0x17');let _0xe4378c=(_0x1d60a2===_0x651d('0x18')||_0x1d60a2===_0x651d('0x19'))&&config['blockUnlocker'][_0x651d('0x1a')]?_0x245a6b[_0x651d('0x1b')]+0x1:_0x245a6b[_0x651d('0x1b')];let _0x1f50c3=config[_0x651d('0x1c')][_0x651d('0x1d')]?_0x651d('0x1e'):_0x651d('0x1f');apiInterfaces['rpcDaemon'](_0x1f50c3,{'height':_0xe4378c},function(_0x4cd79d,_0x2312c7){if(_0x4cd79d){log(_0x651d('0xf'),logSystem,_0x651d('0x20'),[_0x1f50c3,_0x245a6b[_0x651d('0x21')],_0x4cd79d]);_0x245a6b[_0x651d('0x22')]=![];_0x1fc6b2();return;}if(!_0x2312c7[_0x651d('0x23')]){log('error',logSystem,_0x651d('0x24'),[_0x245a6b[_0x651d('0x21')],_0x4cd79d]);_0x245a6b[_0x651d('0x22')]=![];_0x1fc6b2();return;}let _0x3e9cb4=_0x2312c7[_0x651d('0x23')];_0x245a6b[_0x651d('0x25')]=_0x3e9cb4['hash']===_0x245a6b['hash']?0x0:0x1;_0x245a6b[_0x651d('0x22')]=_0x3e9cb4[_0x651d('0x26')]>=config[_0x651d('0x1c')][_0x651d('0x26')];_0x245a6b[_0x651d('0x27')]=_0x3e9cb4[_0x651d('0x27')];if(config[_0x651d('0x1c')][_0x651d('0x1d')]){let _0x2c42e2=JSON[_0x651d('0x28')](_0x2312c7['json'])[_0x651d('0x29')][_0x651d('0x2a')];if(!_0x2c42e2[_0x651d('0x11')]){log('error',logSystem,'Error:\x20tx\x20at\x20height\x20%s\x20has\x20no\x20vouts!',[_0xe4378c]);_0x245a6b[_0x651d('0x22')]=![];_0x1fc6b2();return;}_0x245a6b[_0x651d('0x27')]=_0x2c42e2[0x0][_0x651d('0x2b')];}else{_0x245a6b[_0x651d('0x27')]=_0x3e9cb4[_0x651d('0x27')];}if(config[_0x651d('0x1c')][_0x651d('0x2c')]){let _0x3a1ba1=config['blockUnlocker'][_0x651d('0x2c')]/0x64;_0x245a6b[_0x651d('0x27')]=_0x245a6b[_0x651d('0x27')]-_0x245a6b[_0x651d('0x27')]*_0x3a1ba1;}_0x1fc6b2(_0x245a6b[_0x651d('0x22')]);});},function(_0x3b9b31){if(_0x3b9b31[_0x651d('0x11')]===0x0){log('info',logSystem,_0x651d('0x2d'),[_0x7f54d4[_0x651d('0x11')]]);_0xf4c8ac(!![]);return;}_0xf4c8ac(null,_0x3b9b31);});},function(_0xcaf13d,_0x265915){let _0x55c715=_0xcaf13d[_0x651d('0x2e')](function(_0x34a58a){if(_0x34a58a['rewardType']===_0x651d('0x2f'))return[_0x651d('0x30'),config[_0x651d('0x31')]+_0x651d('0x32')+_0x34a58a[_0x651d('0x1b')]];else return[_0x651d('0x30'),config[_0x651d('0x31')]+':scores:solo:round'+_0x34a58a[_0x651d('0x1b')]];});redisClient[_0x651d('0x33')](_0x55c715)[_0x651d('0x34')](function(_0x3ed995,_0x24ecee){if(_0x3ed995){log(_0x651d('0xf'),logSystem,_0x651d('0x35'),[_0x3ed995]);_0x265915(!![]);return;}for(let _0x2f0a45=0x0;_0x2f0a45<_0x24ecee[_0x651d('0x11')];_0x2f0a45++){let _0x3ded64=_0x24ecee[_0x2f0a45];_0xcaf13d[_0x2f0a45][_0x651d('0x36')]=_0x3ded64;}_0x265915(null,_0xcaf13d);});},function(_0x165d14,_0x45294a){let _0x3a3353=[];_0x165d14['forEach'](function(_0x2fd426){if(!_0x2fd426['orphaned'])return;_0x3a3353[_0x651d('0x14')]([_0x651d('0x37'),config[_0x651d('0x31')]+_0x651d('0x38')+_0x2fd426['height']]);_0x3a3353[_0x651d('0x14')]([_0x651d('0x37'),config['coin']+_0x651d('0x32')+_0x2fd426[_0x651d('0x1b')]]);_0x3a3353[_0x651d('0x14')]([_0x651d('0x37'),config[_0x651d('0x31')]+_0x651d('0x39')+_0x2fd426[_0x651d('0x1b')]]);_0x3a3353[_0x651d('0x14')]([_0x651d('0x37'),config[_0x651d('0x31')]+_0x651d('0x3a')+_0x2fd426['height']]);_0x3a3353[_0x651d('0x14')](['zrem',config['coin']+_0x651d('0xd'),_0x2fd426[_0x651d('0x21')]]);_0x3a3353['push']([_0x651d('0x3b'),config[_0x651d('0x31')]+_0x651d('0x3c'),_0x2fd426[_0x651d('0x1b')],[_0x2fd426[_0x651d('0x3d')],_0x2fd426[_0x651d('0x3e')],_0x2fd426[_0x651d('0x3f')],_0x2fd426[_0x651d('0x40')],_0x2fd426[_0x651d('0x41')],_0x2fd426[_0x651d('0x42')],_0x2fd426[_0x651d('0x25')]][_0x651d('0x43')](':')]);if(_0x2fd426[_0x651d('0x36')]&&!slushMiningEnabled){let _0x354cb1=_0x2fd426[_0x651d('0x36')];Object['keys'](_0x354cb1)[_0x651d('0x44')](function(_0x1435d5){_0x3a3353['push']([_0x651d('0x45'),config[_0x651d('0x31')]+_0x651d('0x46'),_0x1435d5,_0x354cb1[_0x1435d5]]);});}notifications[_0x651d('0x47')](_0x651d('0x48'),{'HEIGHT':_0x2fd426[_0x651d('0x1b')],'BLOCKTIME':utils['dateFormat'](new Date(parseInt(_0x2fd426[_0x651d('0x40')])*0x3e8),_0x651d('0x49')),'HASH':_0x2fd426['hash'],'DIFFICULTY':_0x2fd426[_0x651d('0x41')],'SHARES':_0x2fd426[_0x651d('0x42')],'EFFORT':Math[_0x651d('0x4a')](_0x2fd426[_0x651d('0x42')]/_0x2fd426['difficulty']*0x64)+'%'});});if(_0x3a3353[_0x651d('0x11')]>0x0){redisClient[_0x651d('0x33')](_0x3a3353)[_0x651d('0x34')](function(_0x13e16a,_0x2b6d54){if(_0x13e16a){log(_0x651d('0xf'),logSystem,_0x651d('0x4b'),[_0x13e16a]);_0x45294a(!![]);return;}_0x45294a(null,_0x165d14);});}else{_0x45294a(null,_0x165d14);}},function(_0x1fa237,_0xce1bf0){let _0x355033=[];let _0x56270e={};let _0x2a2a7c=0x0;_0x1fa237[_0x651d('0x44')](function(_0x1daf1d){if(_0x1daf1d[_0x651d('0x25')])return;_0x2a2a7c++;_0x355033[_0x651d('0x14')](['del',config[_0x651d('0x31')]+_0x651d('0x38')+_0x1daf1d[_0x651d('0x1b')]]);_0x355033[_0x651d('0x14')]([_0x651d('0x37'),config['coin']+_0x651d('0x32')+_0x1daf1d[_0x651d('0x1b')]]);_0x355033[_0x651d('0x14')]([_0x651d('0x37'),config[_0x651d('0x31')]+_0x651d('0x39')+_0x1daf1d[_0x651d('0x1b')]]);_0x355033['push']([_0x651d('0x37'),config[_0x651d('0x31')]+_0x651d('0x3a')+_0x1daf1d['height']]);_0x355033[_0x651d('0x14')]([_0x651d('0x4c'),config[_0x651d('0x31')]+_0x651d('0xd'),_0x1daf1d[_0x651d('0x21')]]);_0x355033[_0x651d('0x14')]([_0x651d('0x3b'),config['coin']+_0x651d('0x3c'),_0x1daf1d[_0x651d('0x1b')],[_0x1daf1d[_0x651d('0x3d')],_0x1daf1d[_0x651d('0x3e')],_0x1daf1d[_0x651d('0x3f')],_0x1daf1d[_0x651d('0x40')],_0x1daf1d[_0x651d('0x41')],_0x1daf1d[_0x651d('0x42')],_0x1daf1d[_0x651d('0x25')],_0x1daf1d[_0x651d('0x27')]][_0x651d('0x43')](':')]);let _0x58c33f=config['blockUnlocker'][_0x651d('0x4d')]/0x64;if(Object[_0x651d('0x4e')](donations)[_0x651d('0x11')]){for(let _0xb8fa28 in donations){let _0x21b108=donations[_0xb8fa28]/0x64;_0x58c33f+=_0x21b108;_0x56270e[_0xb8fa28]=Math[_0x651d('0x4a')](_0x1daf1d[_0x651d('0x27')]*_0x21b108);log(_0x651d('0x9'),logSystem,_0x651d('0x4f'),[_0x1daf1d[_0x651d('0x1b')],_0xb8fa28,_0x21b108,_0x56270e[_0xb8fa28]]);}}let _0xf2424=Math[_0x651d('0x4a')](_0x1daf1d[_0x651d('0x27')]-_0x1daf1d[_0x651d('0x27')]*_0x58c33f);log('info',logSystem,_0x651d('0x50'),[_0x1daf1d['height'],_0x1daf1d[_0x651d('0x27')],_0x58c33f,_0xf2424]);if(_0x1daf1d['workerScores']){let _0x25a1b2=parseFloat(_0x1daf1d['score']);if(_0x1daf1d[_0x651d('0x3d')]===_0x651d('0x51')){let _0x1b66fa=_0x1daf1d[_0x651d('0x3e')];_0x56270e[_0x1b66fa]=(_0x56270e[_0x1b66fa]||0x0)+_0xf2424;log(_0x651d('0x9'),logSystem,_0x651d('0x52'),[_0x1daf1d[_0x651d('0x1b')],_0x1b66fa,0x64,_0x56270e[_0x1b66fa]]);}else{Object['keys'](_0x1daf1d[_0x651d('0x36')])[_0x651d('0x44')](function(_0x16cbf1){let _0x21b108=_0x1daf1d[_0x651d('0x36')][_0x16cbf1]/_0x25a1b2;let _0xa19b21=Math[_0x651d('0x4a')](_0xf2424*_0x21b108);_0x56270e[_0x16cbf1]=(_0x56270e[_0x16cbf1]||0x0)+_0xa19b21;log(_0x651d('0x9'),logSystem,_0x651d('0x53'),[_0x1daf1d[_0x651d('0x1b')],_0x16cbf1,_0x21b108*0x64,_0x56270e[_0x16cbf1]]);});}}notifications[_0x651d('0x47')](_0x651d('0x54'),{'HEIGHT':_0x1daf1d[_0x651d('0x1b')],'BLOCKTIME':utils[_0x651d('0x55')](new Date(parseInt(_0x1daf1d['time'])*0x3e8),_0x651d('0x49')),'HASH':_0x1daf1d[_0x651d('0x3f')],'REWARD':utils[_0x651d('0x56')](_0x1daf1d[_0x651d('0x27')]),'DIFFICULTY':_0x1daf1d[_0x651d('0x41')],'SHARES':_0x1daf1d[_0x651d('0x42')],'EFFORT':Math[_0x651d('0x4a')](_0x1daf1d[_0x651d('0x42')]/_0x1daf1d[_0x651d('0x41')]*0x64)+'%'});});for(let _0x3d9a32 in _0x56270e){let _0x585969=parseInt(_0x56270e[_0x3d9a32]);if(_0x585969<=0x0){delete _0x56270e[_0x3d9a32];continue;}_0x355033[_0x651d('0x14')]([_0x651d('0x45'),config[_0x651d('0x31')]+_0x651d('0x57')+_0x3d9a32,_0x651d('0x58'),_0x585969]);}if(_0x355033[_0x651d('0x11')]===0x0){log(_0x651d('0x9'),logSystem,'No\x20unlocked\x20blocks\x20yet\x20(%d\x20pending)',[_0x1fa237[_0x651d('0x11')]]);_0xce1bf0(!![]);return;}redisClient[_0x651d('0x33')](_0x355033)[_0x651d('0x34')](function(_0x37f313,_0x1c7d88){if(_0x37f313){log(_0x651d('0xf'),logSystem,_0x651d('0x59'),[_0x37f313]);_0xce1bf0(!![]);return;}log(_0x651d('0x9'),logSystem,_0x651d('0x5a'),[_0x2a2a7c,Object[_0x651d('0x4e')](_0x56270e)['length']]);_0xce1bf0(null);});}],function(_0x3c00e7,_0x5f2fbe){setTimeout(runInterval,config['blockUnlocker'][_0x651d('0x5b')]*0x3e8);});}runInterval();